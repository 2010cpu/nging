App.loader.libs.editormdPreview=["#editor/markdown/lib/marked.min.js","#editor/markdown/lib/prettify.min.js","#editor/markdown/lib/raphael.min.js","#editor/markdown/lib/underscore.min.js","#editor/markdown/css/editormd.preview.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.editormd=["#editor/markdown/css/editormd.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.flowChart=["#editor/markdown/lib/flowchart.min.js","#editor/markdown/lib/jquery.flowchart.min.js"];App.loader.libs.sequenceDiagram=["#editor/markdown/lib/sequence-diagram.min.js"];App.loader.libs.xheditor=["#editor/xheditor/xheditor.min.js","#editor/xheditor/xheditor_lang/"+App.lang+".js"];App.loader.libs.ueditor=["#editor/ueditor/ueditor.config.js","#editor/ueditor/ueditor.all.min.js"];App.loader.libs.summernote=["#editor/summernote/summernote.css","#editor/summernote/summernote.min.js","#editor/summernote/lang/summernote-"+App.langTag()+".min.js"];App.loader.libs.summernote_bs4=["#editor/summernote/summernote-bs4.css","#editor/summernote/summernote-bs4.min.js","#editor/summernote/lang/summernote-"+App.langTag()+".min.js"];App.loader.libs.tinymce=["#editor/tinymce/tinymce.min.js","#editor/tinymce/jquery.tinymce.min.js","#editor/tinymce/langs/"+App.langTag("_")+".js"];App.loader.libs.dialog=["#dialog/bootstrap-dialog.min.css","#dialog/bootstrap-dialog.min.js"];App.loader.libs.markdownit=["#markdown/it/markdown-it.min.js","#markdown/it/plugins/emoji/markdown-it-emoji.min.js"];App.loader.libs.codehighlight=["#markdown/it/plugins/highlight/loader/prettify.js","#markdown/it/plugins/highlight/loader/run_prettify.js?skin=sons-of-obsidian"];window.UEDITOR_HOME_URL=ASSETS_URL+"/js/editor/ueditor/";App.editor={browsingFileURL:App.loader.siteURL+"/finder"};App.editor.markdownToHTML=function(e,t,i){if(typeof e=="object"){e=e.attr("id")}else if(e.substr(0,1)=="#"){e=e.substr(1)}App.loader.defined(typeof marked,"editormdPreview");var a={markdown:t,toc:true,tocm:true,emoji:true,taskList:true,tex:true,flowChart:true,sequenceDiagram:true};var r=$.extend({},a,i||{});if(r.flowChart)App.loader.defined(typeof $.fn.flowChart,"flowChart");if(r.sequenceDiagram)App.loader.defined(typeof $.fn.sequenceDiagram,"sequenceDiagram");if(typeof t=="boolean"){var o=t,n=$("#"+e);if(o!=false)n=$("#"+e).find(".markdown-code");n.each(function(){r.markdown=$(this).html();$(this).empty();var e=$(this).attr("id");if(!e){e="markdown-data-"+Math.random();$(this).attr("id",e)}editormd.markdownToHTML(e,r)});return}var d=editormd.markdownToHTML(e,r);return d};App.editor.ueditors=function(e,t,i){$(e).each(function(){App.editor.ueditor(this,t,i)})};App.editor.ueditor=function(e,t,i){if($(e).hasClass("form-control"))$(e).removeClass("form-control");if(!t)t=$(e).attr("action");if(i==null)i={};App.loader.defined(typeof window.UE,"ueditor");if(t){if(t.substr(0,1)=="!")t=t.substr(1);if(t.indexOf("?")>=0){t+="&"}else{t+="?"}t+="format=json&";t+="client=webuploader";i.serverUrl=t}var a=$(e).attr("id");if(!a){a="ueditor-instance-"+Math.random();$(e).attr("id",a)}var r=UE.getEditor(a,i);$(e).data("editor-name","ueditor");$(e).data("editor-object",r)};App.editor.markdowns=function(e,t,i){$(e).each(function(){App.editor.markdown(this,t,i)})};App.editor.markdown=function(e,t,i){var a=false;if(!t)t=$(e).attr("action");App.loader.defined(typeof editormd,"editormd");if(t){if(t.substr(0,1)=="!"){t=t.substr(1);a=true}if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(!a)t+="format=json&";t+="filetype=image&client=markdown"}var r=$(e).parent(),o=r.attr("id");if(o===undefined){o="webx-md-"+window.location.href.replace(/[^\w]+/g,"-");r.attr("id",o)}var n=BACKEND_URL+"/public/assets/backend/js/editor/markdown/";var d={width:"100%",height:r.height(),path:n+"lib/",markdown:$(e).text(),codeFold:true,saveHTMLToTextarea:true,searchReplace:true,watch:true,emoji:true,taskList:true,tocm:true,tex:true,flowChart:true,sequenceDiagram:true,imageUpload:true,imageFormats:["jpg","jpeg","gif","png","bmp"],imageUploadURL:t,crossDomainUpload:true,uploadCallbackURL:n+"plugins/image-dialog/upload_callback.htm",onload:function(){}};var l=$.extend({},d,i||{});if(a){l.toolbarIcons=function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","browsing-image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"]};l.toolbarIconsClass={"browsing-image":"fa-image"};l.toolbarIconTexts={"browsing-image":App.t("选择图片")};l.toolbarHandlers={"browsing-image":function(a,e,t,i){Coscms.Dialog.Modal(App.editor.browsingFileURL+"?size=12&filetype=image&multiple=1",{title:App.t("选择图片"),width:"600px",submit:function(e){var t=e.find('input[type=checkbox][name="id[]"]:checked');if(t.length<=0){App.loader.noty({type:"error",text:T("没有选择任何选项！")})}else{var i=[];t.each(function(){var e=$(this).data("raw");i.push("!["+e.Name+"]("+e.ViewUrl+")")});i=i.join("\n")+"\n";a.replaceSelection(i);e.modal("hide")}},cancel:function(e){}},null).css("z-index",20030902)}};l.lang={toolbar:{"browsing-image":App.t("从服务器选择图片")}}}if(!t)l.imageUpload=false;var s=editormd(o,l);$(e).data("editor-name","markdown");$(e).data("editor-object",s);return s};App.editor.md=App.editor.markdown;App.editor.xheditors=function(e,t,i){$(e).each(function(){App.editor.xheditor(this,t,i)})};App.editor.xheditor=function(e,t,i){App.loader.defined(typeof $.fn.xheditor,"xheditor");if(!t)t=$(e).attr("action");var a,r=BACKEND_URL+"/public/assets/backend/js/editor/xheditor/";if(!t){a=$(e).xheditor({editorRoot:r})}else{if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(t.substr(0,1)=="!"){i=$.extend({modalWidth:620,modalHeight:635,upBtnText:App.t("浏览")},i||{})}else{t+="format=json&"}t+="client=xheditor";var o={Code:{c:"xhe_btnCode",t:"插入代码",h:1,e:function(){var e=this;var t=["erlang","go","html","javascript","php","scala","sql","xquery","xml","yaml","yml"];var i='<div><select id="xheCodeType">';for(var a=0;a<t.length;a++){var r=t[a]=="go"?' selected="selected"':"";i+='<option value="'+t[a]+'"'+r+">"+t[a]+"</option>"}i+='<option value="">其它</option></select></div><div><textarea id="xheCodeValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>';var o=$(i),n=$("#xheCodeType",o),d=$("#xheCodeValue",o),l=$("#xheSave",o);l.click(function(){e.loadBookmark();e.pasteHTML('<pre class="prettyprint linenums lang-'+n.val()+'">'+e.domEncode(d.val())+"</pre>");e.hidePanel();return false});e.saveBookmark();e.showDialog(o)}},EndInput:{c:"xhe_btnEndInput",t:"末尾新行 (Shift+End)",s:"shift+end",e:function(){this.appendHTML("<p><br /></p>")}}};var n={skin:"default",plugins:o,upLinkUrl:t+"&filetype=file",upLinkExt:"zip,rar,7z,tar,gz,txt,xls,doc,docx,ppt,pptx,et,wps,rtf,dps",upImgUrl:t+"&filetype=image",upImgExt:"jpg,jpeg,gif,png",upFlashUrl:t+"&filetype=flash",upFlashExt:"swf",upMediaUrl:t+"&filetype=media",upMediaExt:"avi,wmv,wma,mp3,mp4,mpeg,mkv,rm,rmv,mid",editorRoot:r};n=$.extend(n,i||{});if($.browser.msie&&parseFloat($.browser.version)<10){t="!{editorRoot}xheditor_plugins/multiupload/multiupload.html?uploadurl="+encodeURIComponent(t);if(n.upLinkUrl){n.upLinkUrl=t+"&ext=Attachment("+"*."+n.upLinkExt.replace(/,/g,";*.")+")";n.upLinkExt=""}if(n.upImgUrl){n.upImgUrl=t+"&ext=Image("+"*."+n.upImgExt.replace(/,/g,";*.")+")";n.upImgExt=""}if(n.upFlashUrl){n.upFlashUrl=t+"&ext=Flash("+"*."+n.upFlashExt.replace(/,/g,";*.")+")";n.upFlashExt=""}if(n.upMediaUrl){n.upMediaUrl=t+"&ext=Media("+"*."+n.upMediaUrl.replace(/,/g,";*.")+")";n.upMediaExt=""}}a=$(e).xheditor(n)}$(e).data("editor-name","xheditor");$(e).data("editor-object",a);return a};App.editor.summernotes=function(e,t,i){$(e).each(function(){App.editor.summernote(this,t,i)})};App.editor.summernote=function(r,e,t){if(e==null)e=400;App.loader.defined(typeof $.fn.summernote,"summernote"+(t?"_bs4":""));var o=$(r).attr("action");if(o){if(o.substr(0,1)=="!"){o=o.substr(1)}}$(r).summernote({lang:App.langTag(),minHeight:e,callbacks:{onImageUpload:function(e,t,i){var a=$(e);a.each(function(){var e=this;var t=new FormData;t.append("files[]",e);$.ajax({data:t,type:"POST",url:o,cache:false,contentType:false,processData:false,dataType:"json",success:function(e){if(e.Code!=1){return App.message({title:App.i18n.SYS_INFO,text:e.Info,time:5e3,sticky:false,class_name:e.Code==1?"success":"error"})}$.each(e.Data.files,function(e,t){$(r).summernote("insertImage",t,function(e){})})},error:function(){alert(App.i18n.UPLOAD_ERR)}})})}}})};App.editor.markdownItToHTML=function e(t,i){App.loader.defined(typeof window.markdownit,"markdownit");App.loader.defined(typeof window.prettyPrint,"codehighlight");if(i!=false)t=t.find(".markdown-code");var a=App.editor.markdownItInstance();t.each(function(){$(this).html(a.render($.trim($(this).html())));$(this).find("pre > code").each(function(){$(this).parent("pre").addClass("prettyprint linenums")});if(typeof prettyPrint!=="undefined")prettyPrint()})};App.editor.markdownItInstance=function(){App.loader.defined(typeof window.markdownit,"markdownit");var e=window.markdownit();if(typeof window.markdownitEmoji!="undefined")e.use(window.markdownitEmoji);return e};App.editor.tinymces=function(e,t,i,a){$(e).each(function(){App.editor.tinymce(this,t,i,a)})};App.editor.finderDialog=function(e,i){App.loader.defined(typeof BootstrapDialog,"dialog");var t=BootstrapDialog.show({message:function(t){window["finderDialogCallback"]=function(e){i(e);if(e&&e.length>0)t.close()};return $('<iframe src="'+e+'&callback=finderDialogCallback" style="width:620px;height:635px;border:0;padding:0;margin:0"></iframe>')},onshown:function(e){e.$modal.css("zIndex",2e3);e.$modalBody.css("padding",0)},data:{pageToLoad:e}});return t};App.editor.tinymce=function(e,a,t,i){App.loader.defined(typeof $.fn.tinymce,"tinymce");if(!a)a=$(e).attr("action");var r=false;if(a.substr(0,1)=="!"){a=a.substr(1);r=true}a=a.replace(/[\?&]multiple=1/,"");if(a.indexOf("?")>=0){a+="&"}else{a+="?"}if(!r)a+="format=json&";a+="from=parent&client=tinymce&filetype=";var o="undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat";var n="undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl";var d={height:500,menubar:true,language:App.langTag("_"),plugins:["print preview paste importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable charmap quickbars emoticons"],toolbar:i?o:n,toolbar_sticky:true,autosave_ask_before_unload:true,autosave_interval:"30s",autosave_prefix:"{path}{query}-{id}-",autosave_restore_when_empty:false,autosave_retention:"2m",image_advtab:true,file_picker_callback:function(t,e,i){switch(i.filetype){case"file":t("https://www.google.com/logos/google.jpg",{text:"My text"});break;case"image":App.editor.finderDialog(a+i.filetype,function(e){if(e&&e.length>0)t(e[0],{alt:""})});break;case"media":t("movie.mp4",{source2:"alt.ogg",poster:"https://www.google.com/logos/google.jpg"});break;default:alert("Unsupported file type")}},templates:[{title:"New Table",description:"creates a new table",content:'<div class="mceTmpl"><table width="98%%" border="0" cellspacing="0" cellpadding="0"><tr><th scope="col"> </th><th scope="col"> </th></tr><tr><td> </td><td> </td></tr></table></div>'}],image_caption:true,quickbars_selection_toolbar:"bold italic | quicklink h2 h3 blockquote quickimage quicktable",noneditable_noneditable_class:"mceNonEditable",toolbar_drawer:"sliding",contextmenu:"link imagetools table"};$(e).tinymce($.extend({},d,t|{}))};App.editor.switch=function(e,t,i){var a=e.attr("action")||e.data("upload-url")||"!"+App.editor.browsingFileURL+"?size=12&multiple=1",r=e.data("editor"),o=e.data("editor-name"),n=e.data("editor-object"),d=e.data("current-editor");if(d==r)return;var l=e.data("class");if(l===undefined){l=e.attr("class");if(!l)l="";e.data("class",l)}var s=e.data("content-elem"),p=s;if(s)p=App.loader.parseTmpl(s,{type:r});var m=e.get(0);switch(r){case"markdown":if(i){var c=App.loader.parseTmpl(s,{type:d});if(c&&$(c).length>0){if(e.val()!=$(c).val()&&!confirm("确定要切换吗？切换编辑器将会丢失您当前所做的修改。")){if(t!=null)t();return false}}}switch(o){case"xheditor":if(typeof e.xheditor!="undefined"){e.xheditor(false)}break;case"ueditor":n.destroy();break}if(p&&$(p).length>0){e.text($(p).val());e.val($(p).val())}App.editor.markdown(m,a);e.data("current-editor",r);break;default:if(p&&$(p).length>0){var c=App.loader.parseTmpl(s,{type:d});if(c&&$(c).length>0){$(c).text(e.val());var u=$('textarea[name="'+e.parent().attr("id")+'-html-code"]');if(u.length>0&&u.val()!=""){$(p).text(u.val());$(p).val(u.val())}}e.val($(p).val());e.text($(p).val())}e.parent().removeAttr("class");e.attr("class",l).siblings().remove();App.editor.xheditor(m,a);e.data("current-editor","html")}return true};