App.loader.libs.editormdPreview=["#editor/markdown/lib/marked.min.js","#editor/markdown/lib/prettify.min.js","#editor/markdown/lib/raphael.min.js","#editor/markdown/lib/underscore.min.js","#editor/markdown/css/editormd.preview.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.editormd=["#editor/markdown/css/editormd.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.flowChart=["#editor/markdown/lib/flowchart.min.js","#editor/markdown/lib/jquery.flowchart.min.js"];App.loader.libs.sequenceDiagram=["#editor/markdown/lib/sequence-diagram.min.js"];App.loader.libs.xheditor=["#editor/xheditor/xheditor.min.js","#editor/xheditor/xheditor_lang/"+App.lang+".js"];App.loader.libs.ueditor=["#editor/ueditor/ueditor.config.js","#editor/ueditor/ueditor.all.min.js"];App.loader.libs.codehighlight=["#markdown/it/plugins/highlight/loader/run_prettify.js?skin=sons-of-obsidian"];window.UEDITOR_HOME_URL=ASSETS_URL+"/js/editor/ueditor/";App.editor={browsingFileURL:App.loader.siteURL+"/manager/select_file"};App.editor.parseMarkdown2HTML=function(e,t,i){var r={markdown:t,htmlDecode:"style,script,iframe",tocm:true,emoji:true,taskList:true,tex:true,flowChart:true,sequenceDiagram:true};var a=$.extend({},r,i||{});if(a.flowChart)App.loader.defined(typeof $.fn.flowChart,"flowChart");if(a.sequenceDiagram)App.loader.defined(typeof $.fn.sequenceDiagram,"sequenceDiagram");App.loader.defined(typeof editormd,"editormdPreview");var o=editormd.markdownToHTML(e,a);return o};App.editor.initUEs=function(e,t,i){$(e).each(function(){App.editor.initUE(this,t,i)})};App.editor.initUE=function(e,t,i){if($(e).hasClass("form-control"))$(e).removeClass("form-control");if(!t)t=$(e).attr("action");if(t.substr(0,1)=="!")t=t.substr(1);if(i==null)i={};App.loader.defined(typeof window.UE,"ueditor");if(t!=null){if(t.indexOf("?")>=0){t+="&"}else{t+="?"}t+="format=json&";t+="client=webuploader";i.serverUrl=t}var r=$(e).attr("id");if(!r){r="ueditor-instance-"+Math.random();$(e).attr("id",r)}var a=UE.getEditor(r,i);$(e).data("editor-name","ueditor");$(e).data("editor-object",a)};App.editor.initMDs=function(e,t,i){$(e).each(function(){App.editor.initMarkdown(this,t,i)})};App.editor.initMarkdown=function(e,t,i){var r=false;if(!t)t=$(e).attr("action");if(t.substr(0,1)=="!"){t=t.substr(1);r=true}App.loader.defined(typeof editormd,"editormd");if(t!=null){if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(!r)t+="format=json&";t+="filetype=image&client=markdown"}var a=$(e).parent(),o=a.attr("id");if(o===undefined){o="webx-md-"+window.location.href.replace(/[^\w]+/g,"-");a.attr("id",o)}var d=BACKEND_URL+"/public/assets/backend/js/editor/markdown/";var l={width:"100%",height:a.height(),path:d+"lib/",markdown:$(e).text(),codeFold:true,saveHTMLToTextarea:true,searchReplace:true,watch:true,htmlDecode:"style,script,iframe",emoji:true,taskList:true,tocm:true,tex:true,flowChart:true,sequenceDiagram:true,imageUpload:true,imageFormats:["jpg","jpeg","gif","png","bmp"],imageUploadURL:t,crossDomainUpload:true,uploadCallbackURL:d+"plugins/image-dialog/upload_callback.htm",onload:function(){}};var n=$.extend({},l,i||{});if(r){n.toolbarIcons=function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","browsing-image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"]};n.toolbarIconsClass={"browsing-image":"fa-image"};n.toolbarIconTexts={"browsing-image":App.loader.t("选择图片")};n.toolbarHandlers={"browsing-image":function(r,e,t,i){Coscms.Dialog.Modal(App.editor.browsingFileURL+"?pagerows=12&filetype=image&multiple=1",{title:App.loader.t("选择图片"),width:"600px",submit:function(e){var t=e.find('input[type=checkbox][name="id[]"]:checked');if(t.length<=0){App.loader.noty({type:"error",text:T("没有选择任何选项！")})}else{var i=[];t.each(function(){var e=$(this).data("raw");i.push("!["+e.Name+"]("+e.ViewUrl+")")});i=i.join("\n")+"\n";r.replaceSelection(i);e.modal("hide")}},cancel:function(e){}},null).css("z-index",20030902)}};n.lang={toolbar:{"browsing-image":App.loader.t("从服务器选择图片")}}}if(!t)n.imageUpload=false;var p=editormd(o,n);$(e).data("editor-name","markdown");$(e).data("editor-object",p);return p};App.editor.initMD=App.editor.initMarkdown;App.editor.initXHs=function(e,t,i){$(e).each(function(){App.editor.initXH(this,t,i)})};App.editor.initXH=function(e,t,i){App.loader.defined(typeof $.fn.xheditor,"xheditor");if(!t)t=$(e).attr("action");var r,a=BACKEND_URL+"/public/assets/backend/js/editor/xheditor/";if(!t){r=$(e).xheditor({editorRoot:a})}else{if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(t.substr(0,1)=="!"){i=$.extend({modalWidth:620,modalHeight:635,upBtnText:App.loader.t("浏览")},i||{})}else{t+="format=json&"}t+="client=xheditor";var o={Code:{c:"xhe_btnCode",t:"插入代码",h:1,e:function(){var e=this;var t=["erlang","go","html","javascript","php","scala","sql","xquery","xml","yaml","yml"];var i='<div><select id="xheCodeType">';for(var r=0;r<t.length;r++){var a=t[r]=="go"?' selected="selected"':"";i+='<option value="'+t[r]+'"'+a+">"+t[r]+"</option>"}i+='<option value="">其它</option></select></div><div><textarea id="xheCodeValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>';var o=$(i),d=$("#xheCodeType",o),l=$("#xheCodeValue",o),n=$("#xheSave",o);n.click(function(){e.loadBookmark();e.pasteHTML('<pre class="prettyprint linenums lang-'+d.val()+'">'+e.domEncode(l.val())+"</pre>");e.hidePanel();return false});e.saveBookmark();e.showDialog(o)}},EndInput:{c:"xhe_btnEndInput",t:"末尾新行 (Shift+End)",s:"shift+end",e:function(){this.appendHTML("<p><br /></p>")}}};var d={skin:"default",plugins:o,upLinkUrl:t+"&filetype=file",upLinkExt:"zip,rar,7z,tar,gz,txt,xls,doc,docx,ppt,pptx,et,wps,rtf,dps",upImgUrl:t+"&filetype=image",upImgExt:"jpg,jpeg,gif,png",upFlashUrl:t+"&filetype=flash",upFlashExt:"swf",upMediaUrl:t+"&filetype=media",upMediaExt:"avi,wmv,wma,mp3,mp4,mpeg,mkv,rm,rmv,mid",editorRoot:a};d=$.extend(d,i||{});if($.browser.msie&&parseFloat($.browser.version)<10){t="!{editorRoot}xheditor_plugins/multiupload/multiupload.html?uploadurl="+encodeURIComponent(t);if(d.upLinkUrl){d.upLinkUrl=t+"&ext=Attachment("+"*."+d.upLinkExt.replace(/,/g,";*.")+")";d.upLinkExt=""}if(d.upImgUrl){d.upImgUrl=t+"&ext=Image("+"*."+d.upImgExt.replace(/,/g,";*.")+")";d.upImgExt=""}if(d.upFlashUrl){d.upFlashUrl=t+"&ext=Flash("+"*."+d.upFlashExt.replace(/,/g,";*.")+")";d.upFlashExt=""}if(d.upMediaUrl){d.upMediaUrl=t+"&ext=Media("+"*."+d.upMediaUrl.replace(/,/g,";*.")+")";d.upMediaExt=""}}r=$(e).xheditor(d)}$(e).data("editor-name","xheditor");$(e).data("editor-object",r);return r};App.editor.switch=function(e,t,i){var r=e.attr("action")||e.data("upload-url")||"!"+App.editor.browsingFileURL+"?pagerows=12&multiple=1",a=e.data("editor"),o=e.data("editor-name"),d=e.data("editor-object"),l=e.data("current-editor");if(l==a)return;var n=e.data("class");if(n===undefined){n=e.attr("class");if(!n)n="";e.data("class",n)}var p=e.data("content-elem"),s=p;if(p)s=App.loader.parseTmpl(p,{type:a});var u=e.get(0);switch(a){case"markdown":if(i){var m=App.loader.parseTmpl(p,{type:l});if(m&&$(m).length>0){if(e.val()!=$(m).val()&&!confirm("确定要切换吗？切换编辑器将会丢失您当前所做的修改。")){if(t!=null)t();return false}}}switch(o){case"xheditor":if(typeof e.xheditor!="undefined"){e.xheditor(false)}break;case"ueditor":d.destroy();break}if(s&&$(s).length>0){e.text($(s).val());e.val($(s).val())}App.editor.initMarkdown(u,r);e.data("current-editor",a);break;default:if(s&&$(s).length>0){var m=App.loader.parseTmpl(p,{type:l});if(m&&$(m).length>0){$(m).text(e.val());var c=$('textarea[name="'+e.parent().attr("id")+'-html-code"]');if(c.length>0&&c.val()!=""){$(s).text(c.val());$(s).val(c.val())}}e.val($(s).val());e.text($(s).val())}e.parent().removeAttr("class");e.attr("class",n).siblings().remove();App.editor.initXH(u,r);e.data("current-editor","html")}return true};