App.loader.libs.editormdPreview=["#editor/markdown/lib/marked.min.js","#editor/markdown/lib/prettify.min.js","#editor/markdown/lib/raphael.min.js","#editor/markdown/lib/underscore.min.js","#editor/markdown/css/editormd.preview.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.editormd=["#editor/markdown/css/editormd.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.flowChart=["#editor/markdown/lib/flowchart.min.js","#editor/markdown/lib/jquery.flowchart.min.js"];App.loader.libs.sequenceDiagram=["#editor/markdown/lib/sequence-diagram.min.js"];App.loader.libs.xheditor=["#editor/xheditor/xheditor.min.js","#editor/xheditor/xheditor_lang/"+App.lang+".js"];App.loader.libs.ueditor=["#editor/ueditor/ueditor.config.js","#editor/ueditor/ueditor.all.min.js"];App.loader.libs.summernote=["#editor/summernote/summernote.css","#editor/summernote/summernote.min.js","#editor/summernote/lang/summernote-"+App.langTag()+".js"];App.loader.libs.summernote_bs4=["#editor/summernote/summernote-bs4.css","#editor/summernote/summernote-bs4.min.js","#editor/summernote/lang/summernote-"+App.langTag()+".js"];App.loader.libs.codehighlight=["#markdown/it/plugins/highlight/loader/run_prettify.js?skin=sons-of-obsidian"];window.UEDITOR_HOME_URL=ASSETS_URL+"/js/editor/ueditor/";App.editor={browsingFileURL:App.loader.siteURL+"/manager/select_file"};App.editor.parseMarkdown2HTML=function(e,t,r){var i={markdown:t,htmlDecode:"style,script,iframe",tocm:true,emoji:true,taskList:true,tex:true,flowChart:true,sequenceDiagram:true};var a=$.extend({},i,r||{});if(a.flowChart)App.loader.defined(typeof $.fn.flowChart,"flowChart");if(a.sequenceDiagram)App.loader.defined(typeof $.fn.sequenceDiagram,"sequenceDiagram");App.loader.defined(typeof editormd,"editormdPreview");var o=editormd.markdownToHTML(e,a);return o};App.editor.ueditors=function(e,t,r){$(e).each(function(){App.editor.ueditor(this,t,r)})};App.editor.ueditor=function(e,t,r){if($(e).hasClass("form-control"))$(e).removeClass("form-control");if(!t)t=$(e).attr("action");if(t.substr(0,1)=="!")t=t.substr(1);if(r==null)r={};App.loader.defined(typeof window.UE,"ueditor");if(t!=null){if(t.indexOf("?")>=0){t+="&"}else{t+="?"}t+="format=json&";t+="client=webuploader";r.serverUrl=t}var i=$(e).attr("id");if(!i){i="ueditor-instance-"+Math.random();$(e).attr("id",i)}var a=UE.getEditor(i,r);$(e).data("editor-name","ueditor");$(e).data("editor-object",a)};App.editor.markdowns=function(e,t,r){$(e).each(function(){App.editor.markdown(this,t,r)})};App.editor.markdown=function(e,t,r){var i=false;if(!t)t=$(e).attr("action");if(t.substr(0,1)=="!"){t=t.substr(1);i=true}App.loader.defined(typeof editormd,"editormd");if(t!=null){if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(!i)t+="format=json&";t+="filetype=image&client=markdown"}var a=$(e).parent(),o=a.attr("id");if(o===undefined){o="webx-md-"+window.location.href.replace(/[^\w]+/g,"-");a.attr("id",o)}var d=BACKEND_URL+"/public/assets/backend/js/editor/markdown/";var n={width:"100%",height:a.height(),path:d+"lib/",markdown:$(e).text(),codeFold:true,saveHTMLToTextarea:true,searchReplace:true,watch:true,htmlDecode:"style,script,iframe",emoji:true,taskList:true,tocm:true,tex:true,flowChart:true,sequenceDiagram:true,imageUpload:true,imageFormats:["jpg","jpeg","gif","png","bmp"],imageUploadURL:t,crossDomainUpload:true,uploadCallbackURL:d+"plugins/image-dialog/upload_callback.htm",onload:function(){}};var l=$.extend({},n,r||{});if(i){l.toolbarIcons=function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","browsing-image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"]};l.toolbarIconsClass={"browsing-image":"fa-image"};l.toolbarIconTexts={"browsing-image":App.loader.t("选择图片")};l.toolbarHandlers={"browsing-image":function(i,e,t,r){Coscms.Dialog.Modal(App.editor.browsingFileURL+"?pagerows=12&filetype=image&multiple=1",{title:App.loader.t("选择图片"),width:"600px",submit:function(e){var t=e.find('input[type=checkbox][name="id[]"]:checked');if(t.length<=0){App.loader.noty({type:"error",text:T("没有选择任何选项！")})}else{var r=[];t.each(function(){var e=$(this).data("raw");r.push("!["+e.Name+"]("+e.ViewUrl+")")});r=r.join("\n")+"\n";i.replaceSelection(r);e.modal("hide")}},cancel:function(e){}},null).css("z-index",20030902)}};l.lang={toolbar:{"browsing-image":App.loader.t("从服务器选择图片")}}}if(!t)l.imageUpload=false;var s=editormd(o,l);$(e).data("editor-name","markdown");$(e).data("editor-object",s);return s};App.editor.md=App.editor.markdown;App.editor.xheditors=function(e,t,r){$(e).each(function(){App.editor.xheditor(this,t,r)})};App.editor.xheditor=function(e,t,r){App.loader.defined(typeof $.fn.xheditor,"xheditor");if(!t)t=$(e).attr("action");var i,a=BACKEND_URL+"/public/assets/backend/js/editor/xheditor/";if(!t){i=$(e).xheditor({editorRoot:a})}else{if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(t.substr(0,1)=="!"){r=$.extend({modalWidth:620,modalHeight:635,upBtnText:App.loader.t("浏览")},r||{})}else{t+="format=json&"}t+="client=xheditor";var o={Code:{c:"xhe_btnCode",t:"插入代码",h:1,e:function(){var e=this;var t=["erlang","go","html","javascript","php","scala","sql","xquery","xml","yaml","yml"];var r='<div><select id="xheCodeType">';for(var i=0;i<t.length;i++){var a=t[i]=="go"?' selected="selected"':"";r+='<option value="'+t[i]+'"'+a+">"+t[i]+"</option>"}r+='<option value="">其它</option></select></div><div><textarea id="xheCodeValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>';var o=$(r),d=$("#xheCodeType",o),n=$("#xheCodeValue",o),l=$("#xheSave",o);l.click(function(){e.loadBookmark();e.pasteHTML('<pre class="prettyprint linenums lang-'+d.val()+'">'+e.domEncode(n.val())+"</pre>");e.hidePanel();return false});e.saveBookmark();e.showDialog(o)}},EndInput:{c:"xhe_btnEndInput",t:"末尾新行 (Shift+End)",s:"shift+end",e:function(){this.appendHTML("<p><br /></p>")}}};var d={skin:"default",plugins:o,upLinkUrl:t+"&filetype=file",upLinkExt:"zip,rar,7z,tar,gz,txt,xls,doc,docx,ppt,pptx,et,wps,rtf,dps",upImgUrl:t+"&filetype=image",upImgExt:"jpg,jpeg,gif,png",upFlashUrl:t+"&filetype=flash",upFlashExt:"swf",upMediaUrl:t+"&filetype=media",upMediaExt:"avi,wmv,wma,mp3,mp4,mpeg,mkv,rm,rmv,mid",editorRoot:a};d=$.extend(d,r||{});if($.browser.msie&&parseFloat($.browser.version)<10){t="!{editorRoot}xheditor_plugins/multiupload/multiupload.html?uploadurl="+encodeURIComponent(t);if(d.upLinkUrl){d.upLinkUrl=t+"&ext=Attachment("+"*."+d.upLinkExt.replace(/,/g,";*.")+")";d.upLinkExt=""}if(d.upImgUrl){d.upImgUrl=t+"&ext=Image("+"*."+d.upImgExt.replace(/,/g,";*.")+")";d.upImgExt=""}if(d.upFlashUrl){d.upFlashUrl=t+"&ext=Flash("+"*."+d.upFlashExt.replace(/,/g,";*.")+")";d.upFlashExt=""}if(d.upMediaUrl){d.upMediaUrl=t+"&ext=Media("+"*."+d.upMediaUrl.replace(/,/g,";*.")+")";d.upMediaExt=""}}i=$(e).xheditor(d)}$(e).data("editor-name","xheditor");$(e).data("editor-object",i);return i};App.editor.summernotes=function(e,t){$(editorElement).each(function(){App.editor.summernote(this,t)})};App.editor.summernote=function(a,e){if(e==null)e=400;App.loader.defined(typeof $.fn.summernote,"summernote");$(a).summernote({lang:App.langTag(),minHeight:e,callbacks:{onImageUpload:function(e,t,r){var i=$(e);i.each(function(){var e=this;var t=new FormData;t.append("files[]",e);$.ajax({data:t,type:"POST",url:$(a).attr("action"),cache:false,contentType:false,processData:false,dataType:"json",success:function(e){if(e.Code!=1){return App.message({title:App.i18n.SYS_INFO,text:e.Info,time:5e3,sticky:false,class_name:e.Code==1?"success":"error"})}$.each(e.Data.files,function(e,t){$(a).summernote("insertImage",t,function(e){})})},error:function(){alert(App.i18n.UPLOAD_ERR)}})})}}})};App.editor.switch=function(e,t,r){var i=e.attr("action")||e.data("upload-url")||"!"+App.editor.browsingFileURL+"?pagerows=12&multiple=1",a=e.data("editor"),o=e.data("editor-name"),d=e.data("editor-object"),n=e.data("current-editor");if(n==a)return;var l=e.data("class");if(l===undefined){l=e.attr("class");if(!l)l="";e.data("class",l)}var s=e.data("content-elem"),p=s;if(s)p=App.loader.parseTmpl(s,{type:a});var m=e.get(0);switch(a){case"markdown":if(r){var u=App.loader.parseTmpl(s,{type:n});if(u&&$(u).length>0){if(e.val()!=$(u).val()&&!confirm("确定要切换吗？切换编辑器将会丢失您当前所做的修改。")){if(t!=null)t();return false}}}switch(o){case"xheditor":if(typeof e.xheditor!="undefined"){e.xheditor(false)}break;case"ueditor":d.destroy();break}if(p&&$(p).length>0){e.text($(p).val());e.val($(p).val())}App.editor.markdown(m,i);e.data("current-editor",a);break;default:if(p&&$(p).length>0){var u=App.loader.parseTmpl(s,{type:n});if(u&&$(u).length>0){$(u).text(e.val());var c=$('textarea[name="'+e.parent().attr("id")+'-html-code"]');if(c.length>0&&c.val()!=""){$(p).text(c.val());$(p).val(c.val())}}e.val($(p).val());e.text($(p).val())}e.parent().removeAttr("class");e.attr("class",l).siblings().remove();App.editor.xheditor(m,i);e.data("current-editor","html")}return true};