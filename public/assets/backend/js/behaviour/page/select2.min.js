App.select2={i18n:{TAG_INPUT:"请输入或选择，如有多个用逗号隔开",TAG_SELECT:"请输入关键词后从搜索列表中选择",SELECT:"请选择"},tags:function(t,e,a,n,l,r){if(e==null)e=$(t).data("tags")||[];if(a==null)a=$(t).data("url");if(n==null)n=$(t).data("sortable")||false;if(l==null)l=$(t).data("onlyselect")||false;var i=$(t).data("single")||false;var s=$(t).data("map");if(i)i=App.parseBool(i);var u={multiple:!i,width:"100%"};if(l){u.minimumInputLength=1;u.placeholder=App.select2.i18n.TAG_SELECT;u.data=e;u.tags=true}else{u.placeholder=App.select2.i18n.TAG_INPUT;u.tags=e;u.tokenSeparators=[",","，"]}if(a){switch(typeof a){case"string":var o=$(t).data("listkey")||"list";u.query=App.select2.buildQueryFunction(a,{},o,s);break;default:if($.isArray(a)){var o=a.length>2?a[2]:$(t).data("listkey")||"list";u.query=App.select2.buildQueryFunction(a[0],a.length>1?a[1]:{},o,s);break}u.ajax=a;break}}if(!l){var f=function(e){u.tags=e.results};if(typeof u.query!="undefined"){u.query({term:"",callback:f});delete u.query}if(typeof u.ajax!="undefined"){var c=1;$.ajax(u.ajax.url,{dataType:u.ajax.dataType||"json",data:u.ajax.data("",c),async:false}).done(function(e){e=u.ajax.results(e,c);f(e)});delete u.ajax}}if(r)u=$.extend(u,r);var d=$(t).select2(u);$(t).data("select2",d);var p=$(t).data("init");if(p)$(t).val(p.split(",")).trigger("change");if(!n)return;$(t).on("change",function(){var e;if(typeof t=="string"&&t.indexOf("#")===0){e=t+"_val"}else{e=$(t).attr("id")+"_val"}$(e).html($(t).val())});$(t).select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){$(t).select2("onSortStart")},update:function(){$(t).select2("onSortEnd")}})},select:function(e,t){var a={placeholder:App.select2.i18n.SELECT,width:"100%",minimumInputLength:3};t=$.extend({},a,t||{});var n=$(e).select2(t);$(e).data("select2",n)},update:function(e,t){$(e).select2("data",t)},enable:function(e,t){$(e).prop("disabled",!t)},readonly:function(e,t){$(e).prop("disabled",t)},clear:function(e){$(e).val(null).trigger("change")},buildQueryFunction:function(e,t,s,u){if(s==null)s="list";return function(i){if($.isFunction(t))t=t.call(this,arguments);t.q=i.term;t.select2=1;$.ajax(e,{dataType:"json",data:t,async:false}).done(function(e){if(e.Code!=1){App.message({title:App.i18n.SYS_INFO,text:e.Info,type:"error"},false);return}var t={results:[]};if(u){for(var a=0;a<e.Data[s].length;a++){var n=e.Data[s][a],l={};for(var r in u){l[r]=n[u[r]]}t.results.push(l)}}else{t.results=e.Data[s]}i.callback(t)})}},buildAjaxOptions:function(e,a,u,o){if(u==null)u="list";var t={url:"",dataType:"json",quietMillis:250,data:function(e,t){if($.isFunction(a))a=a.call(this,arguments);return $.extend({},{q:e,page:t,select2:1},a||{})},results:function(e,t){if(e.Code!=1){App.message({title:App.i18n.SYS_INFO,text:res.Info,type:"error"},false);return{results:[],more:false}}var a=t<e.Data.pagination.pages;var n={results:[],more:a};if(o){for(var l=0;l<e.Data[u].length;l++){var r=e.Data[u][l],i={};for(var s in o){i[s]=r[o[s]]}n.results.push(i)}}else{n.results=e.Data[u]}return n}};return $.extend({},t,e||{})}};