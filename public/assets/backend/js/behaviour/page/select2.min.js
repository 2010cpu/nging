App.select2={i18n:{TAG_INPUT:"请输入或选择，如有多个用逗号隔开",TAG_SELECT:"请输入关键词后从搜索列表中选择",SELECT:"请选择"},tags:function(i,r,e,t,a,l){if(r==null)r=$(i).data("tags")||[];if(e==null)e=$(i).data("url");if(t==null)t=$(i).data("sortable")||false;if(a==null)a=$(i).data("onlyselect")||false;var n=$(i).data("single")||false;var s=$(i).data("map");if(n)n=App.parseBool(n);var u={multiple:!n,width:"100%",minimumInputLength:0,tokenSeparators:[",","，"]};if(a){u.placeholder=App.select2.i18n.TAG_SELECT;u.data=r;u.tags=true}else{u.placeholder=App.select2.i18n.TAG_INPUT;u.tags=r}var o=null,c=null;if(e){switch(typeof e){case"string":var f=$(i).data("listkey")||"list";o=App.select2.buildQueryFunction(e,{},f,s);break;default:if($.isArray(e)){var f=e.length>2?e[2]:$(i).data("listkey")||"list";o=App.select2.buildQueryFunction(e[0],e.length>1?e[1]:{},f,s);break}c=e;break}}if(!a){u.tags=function(e){var t="",a="";if(e){t=e.term}else{a=$(i).val()}var l=function(e){r=e.results};if(o){o({term:t,callback:l,value:a})}else if(c){var n=1;$.ajax(c.url,{dataType:c.dataType||"json",data:c.data(t,n),async:false}).done(function(e){e=c.results(e,n);l(e)})}return r}}else{if(o)u.query=o;else if(c)u.ajax=c}if(l)u=$.extend(u,l);var p=$(i).select2(u);$(i).data("select2",p);var d=$(i).data("init");if(d)$(i).val(d.split(",")).trigger("change");if(!t)return;$(i).on("change",function(){var e;if(typeof i=="string"&&i.indexOf("#")===0){e=i+"_val"}else{e=$(i).attr("id")+"_val"}$(e).html($(i).val())});$(i).select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){$(i).select2("onSortStart")},update:function(){$(i).select2("onSortEnd")}})},select:function(e,t){var a={placeholder:App.select2.i18n.SELECT,width:"100%",minimumInputLength:0};t=$.extend({},a,t||{});var l=$(e).select2(t);$(e).data("select2",l)},update:function(e,t){$(e).select2("data",t)},enable:function(e,t){$(e).prop("disabled",!t)},readonly:function(e,t){$(e).prop("disabled",t)},clear:function(e){$(e).val(null).trigger("change")},buildQueryFunction:function(e,t,s,u){if(s==null)s="list";return function(r){if($.isFunction(t))t=t.call(this,arguments);t.q=r.term;t.value=r.value;t.select2=1;$.ajax(e,{dataType:"json",data:t,async:false}).done(function(e){if(e.Code!=1){App.message({title:App.i18n.SYS_INFO,text:e.Info,type:"error"},false);return}var t={results:[]};if(u){for(var a=0;a<e.Data[s].length;a++){var l=e.Data[s][a],n={};for(var i in u){n[i]=l[u[i]]}t.results.push(n)}}else{t.results=e.Data[s]}r.callback(t)})}},buildAjaxOptions:function(e,a,u,o){if(u==null)u="list";var t={url:"",dataType:"json",quietMillis:250,data:function(e,t){if($.isFunction(a))a=a.call(this,arguments);return $.extend({},{q:e,page:t,select2:1},a||{})},results:function(e,t){if(e.Code!=1){App.message({title:App.i18n.SYS_INFO,text:res.Info,type:"error"},false);return{results:[],more:false}}var a=t<e.Data.pagination.pages;var l={results:[],more:a};if(o){for(var n=0;n<e.Data[u].length;n++){var i=e.Data[u][n],r={};for(var s in o){r[s]=i[o[s]]}l.results.push(r)}}else{l.results=e.Data[u]}return l}};return $.extend({},t,e||{})}};