if(typeof window.CropServerURL=="undefined"){window.CropServerURL=BACKEND_URL+"/manager/crop"}else{window.CropServerURL=window.CropServerURL||BACKEND_URL+"/manager/crop"}function cropImage(e,n,i){var s=null;$("#fileupload").fileupload({url:e,dataType:"json",done:function(e,a){var r=a.result;if(r.Code!=1){return App.message({title:App.i18n.SYS_INFO,text:r.Info,time:5e3,sticky:false,class_name:r.Code==1?"success":"error"})}var o=function(){s.destroy();$(".crop-image").empty();s=null};if(s)o();$.each(r.Data.files,function(e,a){$(i).val(a);$(".crop-image").html('<img src="'+a+"?_="+Math.random()+'" />');$("#progress").fadeOut();$("#save-image").data("image-file",a);var r=$(".crop-image img");r.Jcrop({aspectRatio:1},function(){s=this})});if(typeof $.fn.niftyModal!="undefined"){$("#crop-image").niftyModal("show",{afterClose:o})}else{$("#crop-image").modal("show");$("#crop-image").off("hide.bs.modal").on("hide.bs.modal",function(){o()})}},progressall:function(e,a){var r=parseInt(a.loaded/a.total*100,10);$("#progress").fadeIn();$("#progress").css("width",r+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?undefined:"disabled");$("#save-image").on("click",function(){var t=$(this);App.getImgNaturalDimensions($(".crop-image img")[0],function(e){var a=$(".crop-image img");var r=s.tellSelect();if(r.w!=0){var o=e.w/a.width();var i=t.data("image-file");$.get(window.CropServerURL+"?src="+i+"&x="+r.x*o+"&y="+r.y*o+"&w="+r.w*o+"&h="+r.h*o,{},function(e){if(e.Code!=1){return App.message({title:App.i18n.SYS_INFO,text:e.Info,time:5e3,sticky:false,class_name:e.Code==1?"success":"error"})}$(".profile-avatar").attr("src",e.Data+"?_="+Math.random());$(n).val(e.Data);if(typeof $.fn.niftyModal!="undefined"){$("#crop-image").niftyModal("hide")}else{$("#crop-image").modal("hide")}s.destroy();$(".crop-image").empty();s=null},"json")}else{alert("Please select a crop region then press save.")}})});$(".avatar-upload .avatar-remove").on("click",function(){$(".profile-avatar").attr("src","");$(i).val("");$(n).val("")})}