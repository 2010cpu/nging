(function(r){defaults={formDataKey:"files",buttonText:"Add Files",buttonClass:"file-preview-button",shadowClass:"file-preview-shadow",tableCss:"file-preview-table",tableRowClass:"file-preview-row",placeholderClass:"file-preview-placeholder",loadingCss:"file-preview-loading",previewTableContainer:"",ajaxDataType:"json",tableTemplate:function(){return"<table class='table table-striped file-preview-table' id='file-preview-table'>"+"<tbody></tbody>"+"</table>"},rowTemplate:function(e){return"<tr class='"+config.tableRowClass+"'>"+"<td class='filethumb'>"+"<img src='"+e.src+"' class='"+e.placeholderCssClass+"' />"+"</td>"+"<td class='filename'>"+e.name+"</td>"+"<td class='filesize'>"+e.size+"</td>"+"<td class='remove-file'><button class='btn btn-danger'>&times;</button></td>"+"</tr>"},loadingTemplate:function(){return"<div id='file-preview-loading-container'>"+"<div id='"+config.loadingCss+"' class='loader-inner ball-clip-rotate-pulse no-show'>"+"<div></div>"+"<div></div>"+"</div>"+"</div>"}};var g;if(typeof App!="undefined"&&typeof App.formatBytes=="function"){g=App.formatBytes}else{if(typeof Humanize=="undefined"||typeof Humanize.filesize!="function"){r.getScript("https://cdnjs.cloudflare.com/ajax/libs/humanize-plus/1.5.0/humanize.min.js")}g=function(e){return Humanize.fileSize(e)}}var v=function(e){var t;t=function(){switch(true){case/video/.test(e):return"video";case/audio/.test(e):return"audio";case/pdf/.test(e):return"pdf";case/csv|excel/.test(e):return"spreadsheet";case/powerpoint/.test(e):return"powerpoint";case/msword|text/.test(e):return"document";case/zip/.test(e):return"zip";case/rar/.test(e):return"rar";default:return"default-filetype"}}();return defaults.placeholderClass+" "+t};r.fn.uploadPreviewer=function(e,c){var s=this;var i=r(this).prop("multiple");if(!e){e={}}config=r.extend({},defaults,e);var t,p,n,d,a,u=[];if(window.File&&window.FileReader&&window.FileList&&window.Blob){this.wrap("<span class='btn btn-primary "+config.shadowClass+"'></span>");t=this.parent("."+config.shadowClass);t.prepend("<span>"+config.buttonText+"</span>");t.wrap("<span class='"+config.buttonClass+"'></span>");a=config.previewTable;if(!a){a="table."+config.tableCss;if(config.previewTableContainer){r(config.previewTableContainer).html(config.tableTemplate());var o=r(config.previewTableContainer).attr("id");if(o)a="#"+o+" "+a}else{r("span."+config.buttonClass).after(config.tableTemplate())}}n=r(a);n.addClass(config.tableCss);d=n.find("tbody");p=config.previewRowTemplate||config.rowTemplate;n.after(config.loadingTemplate());n.on("click",".remove-file",function(){var e=r(this).parent("tr");var t=e.find(".filename").text();for(var i=0;i<u.length;i++){if(u[i].name==t){u.splice(i,1);break}}e.remove();r.event.trigger({type:"file-preview:removed",filename:t})});this.on("change",function(e){var l=r("#"+config.loadingCss);l.show();var t;var f=e.currentTarget.files.length;if(!i&&f>0){u=[];d.empty()}r.each(e.currentTarget.files,function(o,r){u.push(r);t=new FileReader;t.onload=function(e){var t,i,n,a,s;if(d){i=r.type;if(/image/.test(i)){s=e.target.result;a=config.placeholderClass+" image"}else{s="";a=v(i)}t=g(r.size);n=p({src:s,name:r.name,placeholderCssClass:a,size:t});d.append(n);if(o==f-1){l.hide()}}if(c){c(e)}};t.readAsDataURL(r)});r.event.trigger({type:"file-preview:changed",files:u})});this.fileList=function(){return u};this.clearFileList=function(){d.find(".remove-file").click()};this.url=function(e){if(e!=undefined){config.url=e}else{return config.url}};this._onComplete=function(e){e["type"]="file-preview:submit:complete";r.event.trigger(e)};this.submit=function(n,a){if(config.url==undefined)throw"Please set the URL to which I shall post the files";if(u.length>0){var t=new FormData;u.forEach(function(e){t.append(config.formDataKey+"[]",e)});r.ajax({type:"POST",url:config.url,dataType:config.ajaxDataType,data:t,contentType:false,processData:false,xhr:function(){var e=new window.XMLHttpRequest;e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&config.uploadProgress!=null&&typeof config.uploadProgress=="function"){config.uploadProgress(e.loaded/e.total)}},false);return e},success:function(e,t,i){if(typeof n=="function"){n(e,t,i)}s._onComplete({data:e,status:t,jqXHR:i})},error:function(e,t,i){if(typeof a=="function"){a(e,t,i)}s._onComplete({error:i,status:t,jqXHR:e})}})}else{console.log("There are no selected files, please select at least one file before submitting.");s._onComplete({status:"no-files"})}};return this}else{throw"The File APIs are not fully supported in this browser."}}})(jQuery);