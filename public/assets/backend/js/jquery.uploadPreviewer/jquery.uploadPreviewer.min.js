(function(l){defaults={formDataKey:"files",buttonText:"Add Files",buttonClass:"file-preview-button",shadowClass:"file-preview-shadow",tableCss:"file-preview-table",tableRowClass:"file-preview-row",placeholderClass:"file-preview-placeholder",loadingCss:"file-preview-loading",tableTemplate:function(){return"<table class='table table-striped file-preview-table' id='file-preview-table'>"+"<tbody></tbody>"+"</table>"},rowTemplate:function(e){return"<tr class='"+config.tableRowClass+"'>"+"<td>"+"<img src='"+e.src+"' class='"+e.placeholderCssClass+"' />"+"</td>"+"<td class='filename'>"+e.name+"</td>"+"<td class='filesize'>"+e.size+"</td>"+"<td class='remove-file'><button class='btn btn-danger'>&times;</button></td>"+"</tr>"},loadingTemplate:function(){return"<div id='file-preview-loading-container'>"+"<div id='"+config.loadingCss+"' class='loader-inner ball-clip-rotate-pulse no-show'>"+"<div></div>"+"<div></div>"+"</div>"+"</div>"}};var g;if(typeof App!="undefined"&&typeof App.formatBytes=="function"){g=App.formatBytes}else{if(typeof Humanize=="undefined"||typeof Humanize.filesize!="function"){l.getScript("https://cdnjs.cloudflare.com/ajax/libs/humanize-plus/1.5.0/humanize.min.js")}g=function(e){return Humanize.fileSize(e)}}var h=function(e){var t;t=function(){switch(true){case/video/.test(e):return"video";case/audio/.test(e):return"audio";case/pdf/.test(e):return"pdf";case/csv|excel/.test(e):return"spreadsheet";case/powerpoint/.test(e):return"powerpoint";case/msword|text/.test(e):return"document";case/zip/.test(e):return"zip";case/rar/.test(e):return"rar";default:return"default-filetype"}}();return defaults.placeholderClass+" "+t};l.fn.uploadPreviewer=function(i,c){var a=this;if(!i){i={}}config=l.extend({},defaults,i);var e,u,t,d,n,p=[];if(window.File&&window.FileReader&&window.FileList&&window.Blob){this.wrap("<span class='btn btn-primary "+config.shadowClass+"'></span>");e=this.parent("."+config.shadowClass);e.prepend("<span>"+config.buttonText+"</span>");e.wrap("<span class='"+config.buttonClass+"'></span>");n=i.preview_table;if(!n){l("span."+config.buttonClass).after(config.tableTemplate());n="table."+config.tableCss}t=l(n);t.addClass(config.tableCss);d=t.find("tbody");u=i.preview_row_template||config.rowTemplate;t.after(config.loadingTemplate());t.on("click",".remove-file",function(){var e=l(this).parent("tr");var t=e.find(".filename").text();for(var i=0;i<p.length;i++){if(p[i].name==t){p.splice(i,1);break}}e.remove();l.event.trigger({type:"file-preview:changed",files:p})});this.on("change",function(e){var o=l("#"+config.loadingCss);o.show();var t;var f=e.currentTarget.files.length;l.each(e.currentTarget.files,function(l,r){p.push(r);t=new FileReader;t.onload=function(e){var t,i,n,s,a;if(d){i=r.type;if(/image/.test(i)){a=e.target.result;s=config.placeholderClass+" image"}else{a="";s=h(i)}t=g(r.size);n=u({src:a,name:r.name,placeholderCssClass:s,size:t});d.append(n);if(l==f-1){o.hide()}}if(c){c(e)}};t.readAsDataURL(r)});l.event.trigger({type:"file-preview:changed",files:p})});this.fileList=function(){return p};this.clearFileList=function(){l(".remove-file").click()};this.url=function(e){if(e!=undefined){config.url=e}else{return config.url}};this._onComplete=function(e){e["type"]="file-preview:submit:complete";l.event.trigger(e)};this.submit=function(n,s){if(config.url==undefined)throw"Please set the URL to which I shall post the files";if(p.length>0){var t=new FormData;p.forEach(function(e){t.append(i.formDataKey+"[]",e)});l.ajax({type:"POST",url:config.url,data:t,contentType:false,processData:false,xhr:function(){var e=new window.XMLHttpRequest;e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&i!=null&&i.uploadProgress!=null&&typeof i.uploadProgress=="function"){i.uploadProgress(e.loaded/e.total)}},false);return e},success:function(e,t,i){if(typeof n=="function"){n(e,t,i)}a._onComplete({data:e,status:t,jqXHR:i})},error:function(e,t,i){if(typeof s=="function"){s(e,t,i)}a._onComplete({error:i,status:t,jqXHR:e})}})}else{console.log("There are no selected files, please select at least one file before submitting.");a._onComplete({status:"no-files"})}};return this}else{throw"The File APIs are not fully supported in this browser."}}})(jQuery);