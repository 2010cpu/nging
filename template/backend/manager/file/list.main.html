{{Strip}}{{$dialog := Stored.dialog}}
{{$multiple := Stored.multiple}}
<div class="row">
	<div class="col-md-12">
		<div class="block-flat sm-margin-bottom">
			<form class="form-horizontal" action="" id="search-form" method="GET">
				{{- if Stored.dialog -}}
				<input type="hidden" name="multiple" value="{{if $multiple}}1{{else}}0{{end}}" />
				<input type="hidden" name="from" value="{{Form `from`}}" />
				<input type="hidden" name="callback" value="{{Form `callback`}}" />
				{{- end -}}
			<div class="row no-margin">
				<div class="form-group col-sm-3 no-margin xs-margin-top no-padding">
				<div class="input-group no-margin-bottom">
					<span class="input-group-addon">{{"上传时间"|T}}</span>
					<input type="text" id="timerange" class="form-control" name="timerange" value="{{Form `timerange`}}">
				</div>
				</div>
				<div class="form-group col-sm-3 no-margin xs-margin-top no-padding">
				<div class="input-group no-margin-bottom">
					<span class="input-group-addon no-padding no-border"><select name="ownerType" class="form-control" id="ownerType" onchange="ownerTypeChange(this)" style="width:100px">
						<option value="">-{{"用户类型"|T}}-</option>
						{{$ownerType := Form "ownerType"}}
						<option value="user" {{if eq $ownerType `user`}} selected{{end}}>{{`后台用户`|T}}</option>
						<option value="customer" {{if eq $ownerType `customer`}} selected{{end}}>{{`前台客户`|T}}</option>
					</select></span>
					<input name="ownerId" class="form-control" id="ownerId" onchange="$('#search-form').submit()" placeholder="{{`用户ID`|T}}" value="{{Form `ownerId`}}">
				</div>
				</div>
				<div class="form-group col-sm-2 no-margin xs-margin-top no-padding">
				<div class="input-group no-margin-bottom">
					<span class="input-group-addon">{{"内容类型"|T}}</span>
					<select name="table" class="form-control" id="table" onchange="$('#search-form').submit()">
						<option value="">-{{"不限"|T}}-</option>
						{{$table := Form "table"}} 
						{{range $k, $v := Stored.tableNames}}
						<option value="{{$k}}" {{if eq $table $k}} selected{{end}}>{{$v.String}}</option>
						{{end}}
					</select>
				</div>
				</div>
					{{if not $dialog}}
				<div class="form-group col-sm-2 no-margin xs-margin-top no-padding">
				<div class="input-group no-margin-bottom">
					<span class="input-group-addon">{{"文件类型"|T}}</span>
					<select name="type" class="form-control" id="type" onchange="$('#search-form').submit()">
						<option value="">-{{"不限"|T}}-</option>
						{{$type := Stored.fileType}} 
						{{range $k, $v := Stored.fileTypes}}
						<option value="{{$k.String}}" {{if eq $type $k.String}} selected{{end}}>{{$k.String}}</option>
						{{end}}
					</select>
				</div>
				</div>
					{{end}}
				<div class="form-group col-sm-2 no-margin xs-margin-top no-padding">
				<div class="input-group no-margin-bottom">
					<span class="input-group-addon">{{"使用状态"|T}}</span>
					<select name="used" class="form-control" id="used" onchange="$('#search-form').submit()">
						<option value="">-{{"不限"|T}}-</option>
						{{$used := Form "used"}} 
						<option value="0" {{if eq $used `0`}} selected{{end}}>{{`未使用`|T}}</option>
						<option value="1" {{if eq $used `1`}} selected{{end}}>{{`已使用`|T}}</option>
					</select>
				</div>
				</div>
			</div><!-- .row -->
			</form>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<div class="block-flat">
			<div class="header">
				<span class="pull-right">
					<input type="file" multiple="true" id="input-file-upload" style="width:95px" />
				</span>
				{{- if not $dialog -}}
				<a href="javascript:;" class="btn btn-danger pull-right" onclick="App.removeSelected('input:checkbox[name=\'id[]\']','id','__BACKEND__/manager/file/delete/0');">
					<i class="fa fa-trash-o"></i>
					{{"删除选中"|T}}
				</a>
				<h3>{{"附件管理"|T}}</h3>
				{{- else -}}
				<a href="javascript:;" class="btn btn-success pull-right" onclick="applySelected();">
					<i class="fa fa-check"></i>
					{{"选择附件"|T}}
				</a>
				<h3>{{"选择附件"|T}}</h3>
				{{- end -}}
			</div>
			<div class="content">
				<!-- <div class="table-responsive" id="previewTableContainer"></div> -->
				
				<div class="table-responsive">
				<table class="table no-border hover">
					<thead class="no-border auto-fixed" sort-current="{{Form `sort` `-id`}}">
						<tr>
							<th style="width:30px">{{if or (not $dialog) $multiple}}<div class="checkbox checkbox-primary no-margin-y"><input type="checkbox" id="checkedAll"><label for="checkedAll"></label></div>{{end}}</th>
							<th style="width:60px" sort="-id"><strong>ID</strong></th>
							<th style="width:50px"><strong>{{"图片"|T}}</strong></th>
							<th><strong>{{"原始名称"|T}}</strong></th>
							{{if not $dialog}}
							<th><strong>{{"保存位置"|T}}</strong></th>
							{{end}}
							<th style="width:80px" sort="-type"><strong>{{"文件类型"|T}}</strong></th>
							<th style="width:80px" sort="table_name"><strong>{{"内容类型"|T}}</strong></th>
							<th style="width:60px" sort="-size"><strong>{{"大小"|T}}</strong></th>
							<th style="width:80px" sort="-width"><strong>{{"尺寸"|T}}</strong></th>
							<th style="width:85px" sort="-created"><strong>{{"时间"|T}}</strong></th>
							{{if not $dialog}}
							<th style="width:60px" class="text-center"><strong>{{"操作"|T}}</strong></th>
							{{end}}
						</tr>
					</thead>
					<tbody class="no-border-y" id="tbody-content">
                        {{range $k,$v := Stored.listData}}
						<tr>
							<td>
								{{- if not $dialog -}}
								<div class="checkbox checkbox-primary no-margin-y"><input id="checkbox-{{$k}}" class="check-table" type="checkbox" name="id[]" value="{{$v.Id}}"{{if gt $v.UsedTimes 0}} disabled{{end}}><label for="checkbox-{{$k}}"></label></div>
								{{- else if $multiple -}}
								<div class="checkbox checkbox-primary no-margin-y"><input id="checkbox-{{$k}}" class="check-table" type="checkbox" name="id[]" value="{{$v.Id}}" data-file-url="{{$v.ViewUrl}}"><label for="checkbox-{{$k}}"></label></div>
								{{- else -}}
								<div class="radio radio-primary no-margin-y"><input id="radio-{{$k}}" class="check-table" type="radio" name="id" value="{{$v.Id}}" data-file-url="{{$v.ViewUrl}}"><label for="radio-{{$k}}"></label></div>
								{{- end -}}
							</td>
							<td>{{$v.Id}}</td>
							<td class="no-padding">
								<a href="{{$v.ViewUrl}}" target="_blank">
								{{- if eq $v.Type `image` -}}
								<img style="width:50px;height:50px" class="previewable" src="{{if $v.ViewUrl}}{{$v.ViewUrl}}{{else}}__ASSETS__/images/nopreview.jpg{{end}}" onerror="this.onerror=null;this.src='__ASSETS__/images/nopreview.jpg';" />
								{{- else -}}
								<img style="width:50px;height:50px" class="previewable" src="__ASSETS__/images/nopreview.jpg" />
								{{- end -}}
								</a>
							</td>
							<td>
								{{$v.Name}}
								<div class="x-block">
									<span class="label label-{{if gt $v.UsedTimes 0}}primary{{else}}default{{end}} label-xs">{{if gt $v.UsedTimes 0}}{{T `使用%d次` $v.UsedTimes}}{{else}}{{`未使用`|T}}{{end}}</span>
								</div>
							</td>
							{{- if not $dialog -}}
							<td>{{$v.SavePath}}</td>
							{{- end -}}
							<td>{{$v.Type}}</td>
							<td>{{if $v.SubdirInfo}}{{$v.SubdirInfo.String}}{{else}}-{{end}}</td>
							<td>{{FormatBytes $v.Size 2 true}}</td>
							<td>{{$v.Width}}&times;{{$v.Height}}</td>
							<td>{{(Date $v.Created).Format "2006-01-02 15:04:05"}}</td>
							{{- if not $dialog -}}
							<td class="text-center">
							<a class="label label-danger" href="__BACKEND__/manager/file/delete/{{$v.Id}}" onclick="return confirm('{{"真的要删除吗？"|T}}');"><i class="fa fa-times"></i></a>
							</td>
							{{- end -}}
						</tr>
                        {{end}}
					</tbody>
				</table>		
				</div>
				{{Stored.pagination.Render}}
			</div>
		</div>				
	</div>
</div>
{{/Strip}}